"use strict"

const Jimp = require("jimp")
const Cycled = require("cycled")
const delay = require("delay")
const decodeGif = require("decode-gif")

module.exports = (data, callback, { maximumFrameRate = Infinity } = {}) => {
	if (typeof maximumFrameRate !== "number") {
		throw new TypeError(`Expected \`maximumFrameRate\` to be a number, got ${typeof maximumFrameRate}`)
	}

	const { width, height, frames: gifFrames } = decodeGif(data)

	let image

	const renderGifFrame = async ({ data, width, height }) => {
		if (!image) {
			